

## SketchJS

### &#x202b;מה זה?
&#x202b;SketchJS היא ספרייה שמטרתה היא לבצע ייבוא HTML מאתר אחר לתוך ממשק קונימבו.
אנחנו נשתמש בספרייה זו כדי לייבא אלמנטים שעוצבו בSketch ופותחו בעזרת Animaapp launchpad - כאשר כל אלמנט הוא לינק (דף אינטרנט) נפרד, וכל הלינקים ביחד מהווים את האלמנטים בחנות.
SketchJS יודעת לעשות את ההורדה של התוכן, החלפת התכנים במשתנים דינאמיים של קונימבו, והעלאת הקבצים החיצוניים לאחסון בקונימבו. בסיום, SketchJS תשלח את המידע להייבריד קונימבו בעזרת הAPI של קונימבו.

### &#x202b;איך עובד?
1. &#x202b;SketchJS היא פונקציית למבדה בAWS שמופעלת ע"י קריאת HTTP (בעזרת API GATEWAY), במקרה שלנו הקריאה שמפעילה תתבצע מההייבריד SketchImport.
2. על כל&#x202b; URL היא יודעת לעשות קריאה של התוכן הHTML, לבצע את ההמרות בקוד (ליקוידים) ואת ההעלאות של הASSETS (או דרך ממשק קונימבו או ידנית מול S3)
3. &#x202b;SKETCHJS צריכה לזהות האם יש HYBRID_ID - אם יש רק מעדכנת את ההיבריד, אם אין, מייצרת ומחזירה את הHYBRID_ID החדש.


### סדר פעולות - מעצבת
1.  &#x202b;מעצבת עושה את העיצוב עד הסוף בSketch והפלאגאין של animaapp auto-layout.
2. ב&#x202b;סיום המעצבת מחלקת את העיצוב לאלמנטים (כל אלמנט בPAGE).
3. &#x202b;מעצבת עושה Export דרך animaapp launchpad פר אלמנט בדף.
4. &#x202b;על כל אחד מהאלמנטים ממתקבל לינק לPREVIEW - בשלב הזה המעצבת בודקת שאכן היה ייצוא תקין והאלמנט מתפקד כמו שמצופה בכל המצבים.
5. &#x202b;מעצבת מעבירה את כל הלינקים של האלמנטים למנהל הפרויקט במסודר (לפי סדר האלמנטים) דרך האסנה (בפרויקט #)

### מנהל פרויקט
1. מקבל את הלינקים של כל האלמנטים
2. נ&#x202b;כנס לממשק קונימבו לאיזור ההיברידים ומייבא הייבריד (SketchImport) מהחנות PLUGINS 
3. &#x202b;מזין את הערכים של הלינקים והמיקומים והדף (אפשר להוסיף עוד שדות בהמשך) שאני רוצה להייבריד (כל לשונית "Element" היא אלמנט)
  * URL (manual)
  * POSITION (manual)
  * PAGE (manual)
  * STATUS (auto)
  * ELEMENT_ID (auto)
4. מ&#x202b;שתמש בלשונית Export כדי  לייצא את המידע מההיבריד אל הSketchJS בURL הקבוע שלו. (ועם הTOKEN הזמני הרלוונטי כדי לתת גישה לSketchJS לעדכון הייברידים בAPI)
5. ה&#x202b;SketchJS יעדכן התקדמות בהיבריד "SketchImport" בשדה סטטוס, יש לבדוק את שדה הסטטוס

  * &#x202b;הצלחה  - המשך לסעיף 7.

  * &#x202b;בעיית ולידציה - יש לסדר את התכנים בהייבריד SketchImport (עפ"י הדוקומנטציה) ולנסות שנית.

  * &#x202b;שגיאה - יש לפתוח משימה באסנה ולהוסיף לינק להיברידי עם התקלה. (תרחיש 1)

6. &#x202b;במידה והתקבלה שגיאה באחד מהאלמנטים - SketchJS לא ישמור שום דבר, אלא יעשה Revert וישמור את התקלה בשדה LOG.
7. &#x202b;בדיקה בממשק הEDITABLE שאכן האתר מתפקד כמצופה וניתן לערוך את התכנים.
8. בדיקה באתר הלייב בקונימבו שאכן מתפקד כראוי.


### &#x202b;טיפול בתקלות (פיתוח)

&#x202b;תרחיש 1 - מנהל פרויקט ייבא את כל התכנים כמו שצריך (סעיפים 1-4) ולחץ ייצוא לSketchJS, כתוצאה אחד האלמנטים קיבל סטטוס שגיאה

&#x202b;העברת תקלה למשימה למפתח
יחד עם השגיאה יתקבל לינק (ללוג בS3 או לוג של אמזון) עם כל פרטי התקלה.

1. &#x202b;יש לשחזר לוקלית בעזרת הלוג לייצר דימוי של קריאת HTTP שתעשה טריגר לשרת הלוקלי עם הנתונים הבעייתיים (על כל שמירה בפרויקט יווצרו קובצים עם הפלט בלוקלי בתיקיית DIST, במקום לשלוח את המידע לAPI של קונימבו וS3 כמו בפרודקשן)
א. במידה והצלחנו לשחזר - לעבור לסעיף הבא
ב. במידה ולא הצלחנו לשחזר - לנסות ולשחזר ע"ג למבדה בסביבת הSTAGING בענן.
2. &#x202b;ברגע שהצלחנו לשחזר יש לפתוח ISSUE חדש בפרויקט (https://github.com/konimbo/sketchjs/issues/new) במידה ולא קיים ISSUE כזה כבר פתוח, אם קיים כבר ISSUE יש להוסיף את המידע ולעדכן את סעיפים א-ג במקרה הצורך.
א. יש לתייג את המפתח שאמור לטפל ולעשות לייבל של חומרת התקלה (דחוף, גבוה, בינוני, נמוך) * במידה והתקלה דחופה יש להודיע למחבובי באותו רגע. (ו/או שמחבובי יקבל מייל על תקלות דחופות)
ב. יש להוסיף בתיאור התקלה איך לעשות שחזור מלא ובאיזה סביבה (לוקלי או בענן) עם תמונות ולינקים במידת הצורך
ג. יש להוסיף הערכת זמן לטיפול בתקלה (קצר, בינוני, ארוך)

3. &#x202b;מה הגישה למי אחראי על איזה מוצר בקונימבו ואיך מטפלים בתקלות (צוותי או מחלקתי וכד') - דורש חשיבה

4. כ&#x202b;ל בוקר נעשה פרוססינג על הISSUES  וחלוקה לפי תעדוף וסעיף 3


טיפול בתקלה 
1. יש לבצע את השחזור ולקבל מה התקלה בדיוק ובאיזה פונקציה היא מתרחשת עם איזה פרמטרים
2. לבצע הפרדה של הפונקציה משאר הקוד, לבודד ולבדוק את הערכים האלה ולהבין האם יש בעיה בתפקוד הפונקציה או שהבעיה מתקיימת בפונקציה אחרת.
3. &#x202b;במידה ואכן יש בעיה בתפקוד אחת הפונקציות - יש לודא האם התפקוד הזה צריך לקרות ברמת הUNIT TESTING - במידה והפונקציה לא מתפקדת כמצופה - יש לכתוב מחדש את הבדיקות ולתקן לפי TDD
4. להריץ מחדש את הבדיקות - ולקבל את השגיאה על הפונקציה הבעייתית
5. לתקן את הפונקציה
6. להריץ בדיקות מחדש ולוודא שהכל עובר באופן תקין (בדיקה מלאה)
7. &#x202b;לייצר PULL REQUEST ולקשר אותו לISSUE המתאים ולהעביר אותו לCODE REVIEW ולתייג מפתח (לדייק)
8. &#x202b;קבלת הערות על CODE REVIEW וחזרה על סעיפים 5-7.
9. &#x202b;להעביר לCODE REVIEW אצל מחבובי (רק אחרי סיום התיקונים מול מפתח)
10. מרג' ופוש



### פיתוח - משימות
1. צריך לספק קונבנציית עבודה
  * מבנה תיקיות
  * קרוסלות
  * טפסים
  * וכו

  *SketchJS*
2. &#x202b;לייצר קונבנציית עבודה של שליחת המידע מהייבריד לURL מסוים, ב"GROUP "EXPORT יישלחו השדות כהדר'ס והשדות של ההיבריד כDATA בBODY
יהיה טמפלייט של הלשונית EXPORT בחנות PLUGINS עם דוגמא ממשית עם TOKEN וHEADERS וURL

  *KONIMBOIL*

3. ל&#x202b;ייצר הייבריד לדוגמא של "SketchImport" בחנות PLUGINS
3ב. צריך לייצר לשונית "GENERAL" עם TEXTAREA בשם לוג שאליו נעשה אפנד עם כל העדכונים. (במקרה היכשלות שמירה מהלמבדה KONIMBOIL ישמור את הERROR לתוך שדה הלוג)

  *KONIMBOIL*

4. &#x202b;לייצר ENDPOINT של HYBRID עם CRUD מלא - מורד

  *KONIMBOX*

5. TOKEN זמני
##### אופציה א'
&#x202b;לייצר ENDPOINT לAPI "HANDSHAKE" שיקבל האש של הPRIVATEKEY והPUBLICKEY ומייצרת TOKEN זמני לXזמן או Y קריאות (הראשון שביניהם, מקבל את המידע דרך הAPIUSER בסקשן החדש של הTEMP)
5ב. להוסיף לטבלה של APIUSERS שדה של TEMP שהוא סלקט שהערכים שלו הם "לא זמני", "5 דקות", "שעה" וכו'... - מורד
##### אופציה ב'
&#x202b;אינטגרציה עם API GATEWAY בממשק בדף של APIUSERS
5ב. חיבור של KONIMBOX עם APIGATEWAY בעזרת LAMBDA כדי לייצר מיסוך של האוטנטיקציה
##### אופציה ב' ידני
&#x202b;איתמר עושה ידנית את שלב 5, אבל 5ב חייב לקרות גם אם בחרנו ידני וגם אם אוטומטי.

  *KONIMBOX*

6. להוסיף תמיכה בקבלת TOKEN גם דרך הHEADERS מטעמי אבטחה בKONIMBOX

  *KONIMBOX*
